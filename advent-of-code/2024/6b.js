(() => {
  function solve(input) {
    let lines = Utils.read(input);
    let matrix = lines.map((i) => i.split(""));
    let x = 0;
    let y = 0;
    let sum = 0;
    let rows = Array.from(new Array(matrix.length), function () {
      return [];
    });
    let columns = Array.from(new Array(matrix[0].length), function () {
      return [];
    });

    for (let i = 0; i < matrix.length; i++) {
      for (let j = 0; j < matrix[i].length; j++) {
        if (matrix[i][j] === "^") {
          x = i;
          y = j;
        }
        if (matrix[i][j] === "#") {
          rows[i].push(j);
          columns[j].push(i);
        }
      }
    }

    let visited = visitedOnPath(matrix, x, y);
    delete visited[hash(x, y, "")];
    let path = Object.keys(visited);
    for (let position of path) {
      i = Number(position.split(",")[0]);
      j = Number(position.split(",")[1]);
      if (loop(matrix, rows, columns, x, y, i, j)) {
        sum++;
      }
    }

    return sum;
  }

  function visitedOnPath(matrix, x, y) {
    const UP = 0;
    const RIGHT = 1;
    const DOWN = 2;
    const LEFT = 3;
    let dir = UP;
    let visitedWithDir = {};
    let visited = {};

    while (
      x >= 0 &&
      x < matrix.length &&
      y >= 0 &&
      y < matrix[0].length &&
      !visitedWithDir[hash(x, y, dir)]
    ) {
      visitedWithDir[hash(x, y, dir)] = true;
      if (!visited[hash(x, y, "")]) {
        visited[hash(x, y, "")] = true;
      }
      if (dir === UP) {
        if (x > 0 && matrix[x - 1][y] === "#") {
          dir = RIGHT;
        } else {
          x--;
        }
      } else if (dir === RIGHT) {
        if (y < matrix[0].length - 1 && matrix[x][y + 1] === "#") {
          dir = DOWN;
        } else {
          y++;
        }
      } else if (dir === DOWN) {
        if (x < matrix.length - 1 && matrix[x + 1][y] === "#") {
          dir = LEFT;
        } else {
          x++;
        }
      } else if (dir === LEFT) {
        if (y > 0 && matrix[x][y - 1] === "#") {
          dir = UP;
        } else {
          y--;
        }
      }
    }
    return visited;
  }

  function loop(matrix, rows, columns, x, y, obsI, obsJ) {
    const UP = 0;
    const RIGHT = 1;
    const DOWN = 2;
    const LEFT = 3;
    let dir = UP;
    let visitedWithDir = {};
    let visited = {};

    while (
      x >= 0 &&
      x < matrix.length &&
      y >= 0 &&
      y < matrix[0].length &&
      !visitedWithDir[hash(x, y, dir)]
    ) {
      visitedWithDir[hash(x, y, dir)] = true;
      if (!visited[hash(x, y, "")]) {
        visited[hash(x, y, "")] = true;
      }
      if (dir === UP) {
        let arr = columns[y];
        let val = -10;
        for (let i = 0; i < arr.length && arr[i] < x; i++) {
          val = arr[i];
        }
        if (y === obsJ && val < obsI && obsI < x) {
          val = obsI;
        }
        x = val + 1;
        dir = RIGHT;
      } else if (dir === RIGHT) {
        let arr = rows[x];
        let val = matrix[0].length + 10;
        for (let i = arr.length - 1; i >= 0 && arr[i] > y; i--) {
          val = arr[i];
        }
        if (x === obsI && val > obsJ && obsJ > y) {
          val = obsJ;
        }
        y = val - 1;
        dir = DOWN;
      } else if (dir === DOWN) {
        let arr = columns[y];
        let val = matrix.length + 10;
        for (let i = arr.length - 1; i >= 0 && arr[i] > x; i--) {
          val = arr[i];
        }
        if (y === obsJ && val > obsI && obsI > x) {
          val = obsI;
        }
        x = val - 1;
        dir = LEFT;
      } else if (dir === LEFT) {
        let arr = rows[x];
        let val = -10;
        for (let i = 0; i < arr.length && arr[i] < y; i++) {
          val = arr[i];
        }
        if (x === obsI && val < obsJ && obsJ < y) {
          val = obsJ;
        }
        y = val + 1;
        dir = UP;
      }
    }
    return visitedWithDir[hash(x, y, dir)];
  }

  function hash(x, y, dir) {
    return x + "," + y + "," + dir;
  }

  let dataset = [];

  dataset.push({
    input: `....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#...`,
    output: 6,
  });

  dataset.push({
    input: `...#....#................................#..........................#..........#.............#..#.................................
.......#........................#.......#......................#............#.....................................................
..#......#....................................................................................#.......#................#..........
..................#...........#...#..#............................#.........#...................#...............................#.
..#...................................................................................................................#....#......
............#.............................#......................#.......#...........#..................##..............#.........
..............................#................................................#.............................................#....
....................#.#...........#...#....#..............#.........#.........#..................#...........#.................#..
.#........................................................................#.....#.......##.....................#..................
.#........................#..................................#............................#...#..........#.......#.............#..
................................#......#...............#...........................#.............................#..#.#...#....#..
..........................................................#..........#..#.......#........#............#.................#.........
......#.......#......................................................................................#................#...........
##......#...................................................#................#............................#.......................
.....#.................................................................#.....................#...............................#...#
...........................................................................................................#......................
........#......................#..........#..#....#....................#..##...........#..#.............................#.#......#
#...#..................#.....................#...#...#.......................................................#.....#..............
#...#..................#.#....#...............#...........#...................#.....##......................................#.....
......#............................................................................................#...#.#........................
......................................................#..............#.....#.....#..#...........#..............................#..
.........................##.#..............#............#....................................................................##...
..#....................#...........................................................................................#......#.##....
..............#........#..#.......#................#.....#.......................................................................#
.........#..........................#........#..........#...............#...................................#.............#.......
...........#.....................#.....#..............#......#.........................................#..........................
.......##.............................#.........#...............#...............#..............................................#..
.......#.....#.....#...........#............................................................................#..............#.....#
....#.............................................#....#....#....#...........................................##..............##...
.#.............#.......#.....#.........#....#......#.............#............#......#............#......................#........
..................................................................................................#....#..........................
.............................................#....................#...............................#.............#.................
.........#...............#.....................#...............#......#.................................................#.........
..........#.................................................................................#..............#..............#.....#.
.........................#........#.....#............#.....................#.......................................#..............
.....................#.....................#..............................#..................................#..........#.........
........................#.....................#..............................#.#................#.................................
.....................................................#...............#.......................................................#....
.................#.......#......##..............................##.................#..........................#....#....#........#
.............................#................................#..#...........#..........#.........................................
.#...........................#........#.#...#...#....#......#......#...........#..................##.........................#....
.......................................#......................................#................................................#..
..........##......#..............................................................#.......#....................#..#......#.........
.#...............#............#....#....................................^......#.........................................#.#......
.................#....................#..#....#.......................#.............................#.....#.....#............#....
...............................................................#...............##.................#........#.#....................
...................................#..#.........#.........#...............#.........#.......................................#.....
.........................#......................................................................................#............#....
.................................#............#............#.............................#........................................
..........#.........#...........................................#..#...#..#.......................................................
.#....#....#..........................................#.....#..........................................................#..........
...#...............#......................................................................#.............................#.........
....#......................#...........#......................................#..............#...........................#........
.......................................................#...........#.......#..............................#.......................
......#............#.#...........#............#...................#..................#................................##..........
.......#..........................................................................................#.....................##........
....................................#.........#..................##....................#.#...........#......................#.....
.........................#...............................................................#....................#...................
...............................#........................................................................#....................#....
..#.#.......................................................................#..........#.........#........#.......................
....#....#.....................#.............#..#........................#.............#.....#....................................
..#............................................................................#....................#.................#.....#.#...
..............................................#........#............##.#..............#...#...................#...................
.............................#..................#..................#.................................#............................
......#................................#....#..................................#............#.....................................
#..........#...#..................#...............................................................................................
......................................#......................................#.......#....#.......................................
......................................................................#......................................#...........##.....#.
.......#.............#................................................#.....#..#......#......................................#....
..........................................#...............#...#........#..........................................................
#..#......#..........#....#.......................................................................................................
.......#..#............................................................#........#...#.#...........................................
.#....#...#..#................................................#......................#............................................
.........................#...........#..........#............#...............................#...#...#..................#.........
....#......................#......#.......#....................#..........................#...............................#.......
.........................#...............#.........................#.........#..................................#.................
...............................#......................................................#...........................................
..................................................#.........................#...................#......#..........................
...................#.##..............................#................#........#..............................#...................
.#.................#..............................#................#............................#............#................#...
............#..............#....................................#.....#.....#..........#................#.........................
...................#.............................#...........##...........................................#.......................
.#.............##...........#............##...#.........................................................................#.......#.
........#................#....................#..........#....#.......#.#..............#..............#.................#.........
............................#..#...#..........................................................#......#............................
.........#.................#......#.............................................#...##.....#.................................##...
............#..........................................................................#..........#...................#...........
....................................#.............#............#..................#....#.#.......................#...#............
......#...................................................##....................................................................#.
...............................#.............#.#...............#.......................................#.#.......................#
..........#............................#....#.#.#.#..............................................................#................
....#...#............#.#.................................................#.....................................#.#................
...........#...............................##.........#............#.....................#........................................
...................#.............................#.........#..............................................#.....#.................
.........#................#.........#.............#.............#...#...........................................................#.
.....#...........................#............##............#................#...............................#.............#..#...
................#.#.......#.................#...................................................#.........#..........##.#.........
.........................#.................#...............#...........................#............#.............#..............#
...................#......#...........................#.....#.....................................................#...............
......#...........##......#..................#......#............##................................#..............................
....................#.........#...........................................................................................#....#..
................................................#....#.....#..#........................#....................##....................
........#...........#....#.......#..........##............................................#.......#.........#...#...............#.
#.#.....#.#..............................................#...#...............#..........#................##.........#..........#.#
#........................#...#.........#........#..............................................................#..................
..................................................................................................................................
...........................................#..#..........................................#...................#....................
...................#.............#.....#..................................................#...................................#...
................#...........................................................................#.#...#...............................
........#.......#......#...........................................#....................................#......#............#.....
...............#.......#....................#.....................................................................#...............
..............##....#.............................#......................#.....#......#........................................#..
............................#.........#.....................#.....................................................................
#....................#...................##........#...#........#......#....#..........................................#.#.......#
..#............#...#...............................#.#....................#....................................#..............#...
..................#..#.......#......#.....#.......#.................#.....#...................................#.............#.....
.......................#..............#.........#............#.......#.................................................#.....#....
................#.....................................................#.#.............................#.........#...........#.....
......................#.................................##..................................#.................................#...
.......................................#........................................................................#.................
.........#...........#..............#......................#................................#..#.......................#..........
...................#..................#...#....#......................................................#...........................
..............................#.........#................................#............................#...........................
........#....#...................................................................##........#......................................
..................................#...................#...................#.#.......#.............#..............................#
.....................................#...##...............................................................................#.......
......................#.......#.............#.......................#..#.....#......................#.................#...........
.....##...........#.......#................#.................................#...##......#......#...............#.......#.#.......
.....#...#...............#......................#........#..........#..##...#...#........#..........#.............................
#...........#.............#...............................#..............................#...#.#........#.........................`,
    output: 1951,
  });

  Utils.check(solve, dataset, "6b");
})();
